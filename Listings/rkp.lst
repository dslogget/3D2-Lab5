


ARM Macro Assembler    Page 1 


    1 00000000                 AREA             ReadKeyPressArea, CODE, READONL
Y
    2 00000000                 EXPORT           ReadKeyPress
    3 00000000         
    4 00000000                 INCLUDE          REG_DEFS.s
    1 00000000                 AREA             REG_DEFS, CODE, READONLY
    2 00000000         
    3 00000000         
    4 00000000         ;IO DEFS
    5 00000000 E0028000 
                       IO0PIN  EQU              0xE0028000
    6 00000000 E0028004 
                       IO0SET  EQU              0xE0028004
    7 00000000 E0028008 
                       IO0DIR  EQU              0xE0028008
    8 00000000 E002800C 
                       IO0CLR  EQU              0xE002800C
    9 00000000 E0028010 
                       IO1PIN  EQU              0xE0028010
   10 00000000 E0028014 
                       IO1SET  EQU              0xE0028014
   11 00000000 E0028018 
                       IO1DIR  EQU              0xE0028018
   12 00000000 E002801C 
                       IO1CLR  EQU              0xE002801C
   13 00000000         
   14 00000000         
   15 00000000 FFFFF030 
                       VICVECTADDR
                               EQU              0xFFFFF030
   16 00000000 FFFFF00C 
                       VICINTSELECT
                               EQU              0xFFFFF00C
   17 00000000 FFFFF010 
                       VICINTENABLE
                               EQU              0xFFFFF010
   18 00000000 FFFFF034 
                       VICDEFVECTADDR
                               EQU              0xFFFFF034
   19 00000000         
   20 00000000 E0004000 
                       T0IR    EQU              0xE0004000
   21 00000000 E0004004 
                       T0TCR   EQU              0xE0004004
   22 00000000 E0004008 
                       T0TC    EQU              0xE0004008
   23 00000000 E000400C 
                       T0PR    EQU              0xE000400C
   24 00000000 E0004010 
                       T0PC    EQU              0xE0004010
   25 00000000 E0004014 
                       T0MCR   EQU              0xE0004014
   26 00000000 E0004018 
                       T0MR0   EQU              0xE0004018
   27 00000000 E000401C 
                       T0MR1   EQU              0xE000401C
   28 00000000 E0004020 
                       T0MR2   EQU              0xE0004020
   29 00000000 E0004024 



ARM Macro Assembler    Page 2 


                       T0MR3   EQU              0xE0004024
   30 00000000 E0004028 
                       T0CCR   EQU              0xE0004028
   31 00000000 E000402C 
                       T0CR0   EQU              0xE000402C
   32 00000000 E0004030 
                       T0CR1   EQU              0xE0004030
   33 00000000 E0004034 
                       T0CR2   EQU              0xE0004034
   34 00000000 E0004038 
                       T0CR3   EQU              0xE0004038
   35 00000000 E000403C 
                       T0EMR   EQU              0xE000403C
   36 00000000 E0004070 
                       T0CTCR  EQU              0xE0004070
   37 00000000         
   38 00000000 E0008000 
                       T1IR    EQU              0xE0008000
   39 00000000 E0008004 
                       T1TCR   EQU              0xE0008004
   40 00000000 E0008008 
                       T1TC    EQU              0xE0008008
   41 00000000 E000800C 
                       T1PR    EQU              0xE000800C
   42 00000000 E0008010 
                       T1PC    EQU              0xE0008010
   43 00000000 E0008014 
                       T1MCR   EQU              0xE0008014
   44 00000000 E0008018 
                       T1MR0   EQU              0xE0008018
   45 00000000 E000801C 
                       T1MR1   EQU              0xE000801C
   46 00000000 E0008020 
                       T1MR2   EQU              0xE0008020
   47 00000000 E0008024 
                       T1MR3   EQU              0xE0008024
   48 00000000 E0008028 
                       T1CCR   EQU              0xE0008028
   49 00000000 E000802C 
                       T1CR0   EQU              0xE000802C
   50 00000000 E0008030 
                       T1CR1   EQU              0xE0008030
   51 00000000 E0008034 
                       T1CR2   EQU              0xE0008034
   52 00000000 E0008038 
                       T1CR3   EQU              0xE0008038
   53 00000000 E000803C 
                       T1EMR   EQU              0xE000803C
   54 00000000 E0008070 
                       T1CTCR  EQU              0xE0008070
   55 00000000         
   56 00000000         
   57 00000000                 END
    5 00000000         
    6 00000000 00000FA0 
                       RKP_SETTLE
                               EQU              4000
    7 00000000 000C3500 
                       RKP_LONGPRESS



ARM Macro Assembler    Page 3 


                               EQU              800000
    8 00000000         
    9 00000000         
   10 00000000         ;ReadKeyPress
   11 00000000         ; A blocking funtion that waits until a button is presse
                       d, returns the index of button pressed,
   12 00000000         ; and a negated version if the button is long pressed
   13 00000000         ; Each controlled by the vars, RKP_SETTLE for the settle
                        time, and RKP_LONGPRESS for threshhold
   14 00000000         ; for a long press
   15 00000000         ;Register use:
   16 00000000         ;R0 = output reg as per spec
   17 00000000         ;R1 = IO1PIN
   18 00000000         ;R2 = val in R1
   19 00000000         ;R3 = prev val of IO1PIN
   20 00000000         ;R4 = mask
   21 00000000         ;R5 = RKP_cnt
   22 00000000         ;R6 = LONGPRESS VAL
   23 00000000         
   24 00000000         
   25 00000000         
   26 00000000         
   27 00000000         
   28 00000000         
   29 00000000         ReadKeyPress
   30 00000000 E92D5FFE        STMFD            sp!,  {R1-R12, lr} ;Store all r
                                                            egisters that don't
                                                             return a value
   31 00000004         
   32 00000004 E59F6098        LDR              R6,  =RKP_LONGPRESS
   33 00000008         
   34 00000008 E59F1098        LDR              R1,  =IO1DIR ;Setting the pins 
                                                            to input
   35 0000000C E5912000        LDR              R2,  [R1]
   36 00000010 E3C2260F        BIC              R2,  R2,  #(2_1111 << 20)
   37 00000014         
   38 00000014 E59F1090        LDR              R1,  =IO1PIN
   39 00000018 E3A04EFA        LDR              R4,  =RKP_SETTLE ;Resetting the
                                                             settle counter
   40 0000001C         RKP_poll
   41 0000001C E5912000        LDR              R2,  [R1]   ;Read in values and
                                                             shift for easier p
                                                            rocessing
   42 00000020 E202260F        AND              R2,  R2,  #(2_1111 << 20)
   43 00000024 E1A02A22        LSR              R2,  R2,  #20
   44 00000028         
   45 00000028 E1530002        CMP              R3,  R2
   46 0000002C 13A04EFA        LDRNE            R4,  =RKP_SETTLE
   47 00000030 02544001        SUBEQS           R4,  R4,  #1
   48 00000034 E1A03002        MOV              R3,  R2
   49 00000038 1AFFFFF7        BNE              RKP_poll
   50 0000003C         
   51 0000003C         
   52 0000003C         
   53 0000003C E3A04008        LDR              R4,  =2_1000
   54 00000040 E3A05003        LDR              R5,  = 3
   55 00000044         RKP_find
   56 00000044 E1120004        TST              R2,  R4
   57 00000048 0A000004        BEQ              RKP_fend



ARM Macro Assembler    Page 4 


   58 0000004C E2455001        SUB              R5,  #1
   59 00000050 E1B040A4        MOVS             R4,  R4, LSR #1
   60 00000054 03A04EFA        LDREQ            R4,  =RKP_SETTLE
   61 00000058 0AFFFFEF        BEQ              RKP_poll
   62 0000005C EAFFFFF8        B                RKP_find
   63 00000060         RKP_fend
   64 00000060         
   65 00000060 E2850014        ADD              R0,  R5,  #20
   66 00000064         
   67 00000064         
   68 00000064 E3A03000        LDR              R3,  =0
   69 00000068         RKP_cnt
   70 00000068 E5912000        LDR              R2,  [R1]
   71 0000006C E202260F        AND              R2,  R2,  #(2_1111 << 20)
   72 00000070 E1A02A22        LSR              R2,  R2,  #20
   73 00000074         
   74 00000074 E1120004        TST              R2,  R4
   75 00000078 1A000008        BNE              RKP_cntend
   76 0000007C E2833001        ADD              R3,  R3,  #1
   77 00000080 E1530006        CMP              R3,  R6
   78 00000084 1AFFFFF7        BNE              RKP_cnt
   79 00000088 E2600000        RSB              R0,  R0,  #0
   80 0000008C         
   81 0000008C         ;Wait for the button to be released
   82 0000008C         RKP_wait
   83 0000008C E5912000        LDR              R2,  [R1]
   84 00000090 E202260F        AND              R2,  R2,  #(2_1111 << 20)
   85 00000094 E1A02A22        LSR              R2,  R2,  #20
   86 00000098 E1120004        TST              R2,  R4
   87 0000009C 0AFFFFFA        BEQ              RKP_wait
   88 000000A0         
   89 000000A0         
   90 000000A0         RKP_cntend
   91 000000A0 E8BD9FFE        LDMFD            sp!,  {R1-R12, pc}
   92 000000A4         
   93 000000A4         
   94 000000A4                 END
              000C3500 
              E0028018 
              E0028010 
Command Line: --debug --xref --diag_suppress=9931 --apcs=interwork --depend=.\r
kp.d -o.\rkp.o -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Ke
il_v5\ARM\INC\Philips --predefine="__EVAL SETA 1" --predefine="__MICROLIB SETA 
1" --predefine="__UVISION_VERSION SETA 525" --list=.\listings\rkp.lst RKP.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

ReadKeyPressArea 00000000

Symbol: ReadKeyPressArea
   Definitions
      At line 1 in file RKP.s
   Uses
      None
Comment: ReadKeyPressArea unused
1 symbol



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

REG_DEFS 00000000

Symbol: REG_DEFS
   Definitions
      At line 1 in file REG_DEFS.s
   Uses
      None
Comment: REG_DEFS unused
RKP_cnt 00000068

Symbol: RKP_cnt
   Definitions
      At line 69 in file RKP.s
   Uses
      At line 78 in file RKP.s
Comment: RKP_cnt used once
RKP_cntend 000000A0

Symbol: RKP_cntend
   Definitions
      At line 90 in file RKP.s
   Uses
      At line 75 in file RKP.s
Comment: RKP_cntend used once
RKP_fend 00000060

Symbol: RKP_fend
   Definitions
      At line 63 in file RKP.s
   Uses
      At line 57 in file RKP.s
Comment: RKP_fend used once
RKP_find 00000044

Symbol: RKP_find
   Definitions
      At line 55 in file RKP.s
   Uses
      At line 62 in file RKP.s
Comment: RKP_find used once
RKP_poll 0000001C

Symbol: RKP_poll
   Definitions
      At line 40 in file RKP.s
   Uses
      At line 49 in file RKP.s
      At line 61 in file RKP.s

RKP_wait 0000008C

Symbol: RKP_wait
   Definitions
      At line 82 in file RKP.s
   Uses
      At line 87 in file RKP.s
Comment: RKP_wait used once
ReadKeyPress 00000000




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

Symbol: ReadKeyPress
   Definitions
      At line 29 in file RKP.s
   Uses
      At line 2 in file RKP.s
Comment: ReadKeyPress used once
8 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

IO0CLR E002800C

Symbol: IO0CLR
   Definitions
      At line 8 in file REG_DEFS.s
   Uses
      None
Comment: IO0CLR unused
IO0DIR E0028008

Symbol: IO0DIR
   Definitions
      At line 7 in file REG_DEFS.s
   Uses
      None
Comment: IO0DIR unused
IO0PIN E0028000

Symbol: IO0PIN
   Definitions
      At line 5 in file REG_DEFS.s
   Uses
      None
Comment: IO0PIN unused
IO0SET E0028004

Symbol: IO0SET
   Definitions
      At line 6 in file REG_DEFS.s
   Uses
      None
Comment: IO0SET unused
IO1CLR E002801C

Symbol: IO1CLR
   Definitions
      At line 12 in file REG_DEFS.s
   Uses
      None
Comment: IO1CLR unused
IO1DIR E0028018

Symbol: IO1DIR
   Definitions
      At line 11 in file REG_DEFS.s
   Uses
      At line 34 in file RKP.s
Comment: IO1DIR used once
IO1PIN E0028010

Symbol: IO1PIN
   Definitions
      At line 9 in file REG_DEFS.s
   Uses
      At line 38 in file RKP.s
Comment: IO1PIN used once
IO1SET E0028014

Symbol: IO1SET



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 10 in file REG_DEFS.s
   Uses
      None
Comment: IO1SET unused
RKP_LONGPRESS 000C3500

Symbol: RKP_LONGPRESS
   Definitions
      At line 7 in file RKP.s
   Uses
      At line 32 in file RKP.s
Comment: RKP_LONGPRESS used once
RKP_SETTLE 00000FA0

Symbol: RKP_SETTLE
   Definitions
      At line 6 in file RKP.s
   Uses
      At line 39 in file RKP.s
      At line 46 in file RKP.s
      At line 60 in file RKP.s

T0CCR E0004028

Symbol: T0CCR
   Definitions
      At line 30 in file REG_DEFS.s
   Uses
      None
Comment: T0CCR unused
T0CR0 E000402C

Symbol: T0CR0
   Definitions
      At line 31 in file REG_DEFS.s
   Uses
      None
Comment: T0CR0 unused
T0CR1 E0004030

Symbol: T0CR1
   Definitions
      At line 32 in file REG_DEFS.s
   Uses
      None
Comment: T0CR1 unused
T0CR2 E0004034

Symbol: T0CR2
   Definitions
      At line 33 in file REG_DEFS.s
   Uses
      None
Comment: T0CR2 unused
T0CR3 E0004038

Symbol: T0CR3
   Definitions



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

      At line 34 in file REG_DEFS.s
   Uses
      None
Comment: T0CR3 unused
T0CTCR E0004070

Symbol: T0CTCR
   Definitions
      At line 36 in file REG_DEFS.s
   Uses
      None
Comment: T0CTCR unused
T0EMR E000403C

Symbol: T0EMR
   Definitions
      At line 35 in file REG_DEFS.s
   Uses
      None
Comment: T0EMR unused
T0IR E0004000

Symbol: T0IR
   Definitions
      At line 20 in file REG_DEFS.s
   Uses
      None
Comment: T0IR unused
T0MCR E0004014

Symbol: T0MCR
   Definitions
      At line 25 in file REG_DEFS.s
   Uses
      None
Comment: T0MCR unused
T0MR0 E0004018

Symbol: T0MR0
   Definitions
      At line 26 in file REG_DEFS.s
   Uses
      None
Comment: T0MR0 unused
T0MR1 E000401C

Symbol: T0MR1
   Definitions
      At line 27 in file REG_DEFS.s
   Uses
      None
Comment: T0MR1 unused
T0MR2 E0004020

Symbol: T0MR2
   Definitions
      At line 28 in file REG_DEFS.s
   Uses
      None



ARM Macro Assembler    Page 4 Alphabetic symbol ordering
Absolute symbols

Comment: T0MR2 unused
T0MR3 E0004024

Symbol: T0MR3
   Definitions
      At line 29 in file REG_DEFS.s
   Uses
      None
Comment: T0MR3 unused
T0PC E0004010

Symbol: T0PC
   Definitions
      At line 24 in file REG_DEFS.s
   Uses
      None
Comment: T0PC unused
T0PR E000400C

Symbol: T0PR
   Definitions
      At line 23 in file REG_DEFS.s
   Uses
      None
Comment: T0PR unused
T0TC E0004008

Symbol: T0TC
   Definitions
      At line 22 in file REG_DEFS.s
   Uses
      None
Comment: T0TC unused
T0TCR E0004004

Symbol: T0TCR
   Definitions
      At line 21 in file REG_DEFS.s
   Uses
      None
Comment: T0TCR unused
T1CCR E0008028

Symbol: T1CCR
   Definitions
      At line 48 in file REG_DEFS.s
   Uses
      None
Comment: T1CCR unused
T1CR0 E000802C

Symbol: T1CR0
   Definitions
      At line 49 in file REG_DEFS.s
   Uses
      None
Comment: T1CR0 unused
T1CR1 E0008030




ARM Macro Assembler    Page 5 Alphabetic symbol ordering
Absolute symbols

Symbol: T1CR1
   Definitions
      At line 50 in file REG_DEFS.s
   Uses
      None
Comment: T1CR1 unused
T1CR2 E0008034

Symbol: T1CR2
   Definitions
      At line 51 in file REG_DEFS.s
   Uses
      None
Comment: T1CR2 unused
T1CR3 E0008038

Symbol: T1CR3
   Definitions
      At line 52 in file REG_DEFS.s
   Uses
      None
Comment: T1CR3 unused
T1CTCR E0008070

Symbol: T1CTCR
   Definitions
      At line 54 in file REG_DEFS.s
   Uses
      None
Comment: T1CTCR unused
T1EMR E000803C

Symbol: T1EMR
   Definitions
      At line 53 in file REG_DEFS.s
   Uses
      None
Comment: T1EMR unused
T1IR E0008000

Symbol: T1IR
   Definitions
      At line 38 in file REG_DEFS.s
   Uses
      None
Comment: T1IR unused
T1MCR E0008014

Symbol: T1MCR
   Definitions
      At line 43 in file REG_DEFS.s
   Uses
      None
Comment: T1MCR unused
T1MR0 E0008018

Symbol: T1MR0
   Definitions
      At line 44 in file REG_DEFS.s



ARM Macro Assembler    Page 6 Alphabetic symbol ordering
Absolute symbols

   Uses
      None
Comment: T1MR0 unused
T1MR1 E000801C

Symbol: T1MR1
   Definitions
      At line 45 in file REG_DEFS.s
   Uses
      None
Comment: T1MR1 unused
T1MR2 E0008020

Symbol: T1MR2
   Definitions
      At line 46 in file REG_DEFS.s
   Uses
      None
Comment: T1MR2 unused
T1MR3 E0008024

Symbol: T1MR3
   Definitions
      At line 47 in file REG_DEFS.s
   Uses
      None
Comment: T1MR3 unused
T1PC E0008010

Symbol: T1PC
   Definitions
      At line 42 in file REG_DEFS.s
   Uses
      None
Comment: T1PC unused
T1PR E000800C

Symbol: T1PR
   Definitions
      At line 41 in file REG_DEFS.s
   Uses
      None
Comment: T1PR unused
T1TC E0008008

Symbol: T1TC
   Definitions
      At line 40 in file REG_DEFS.s
   Uses
      None
Comment: T1TC unused
T1TCR E0008004

Symbol: T1TCR
   Definitions
      At line 39 in file REG_DEFS.s
   Uses
      None
Comment: T1TCR unused



ARM Macro Assembler    Page 7 Alphabetic symbol ordering
Absolute symbols

VICDEFVECTADDR FFFFF034

Symbol: VICDEFVECTADDR
   Definitions
      At line 18 in file REG_DEFS.s
   Uses
      None
Comment: VICDEFVECTADDR unused
VICINTENABLE FFFFF010

Symbol: VICINTENABLE
   Definitions
      At line 17 in file REG_DEFS.s
   Uses
      None
Comment: VICINTENABLE unused
VICINTSELECT FFFFF00C

Symbol: VICINTSELECT
   Definitions
      At line 16 in file REG_DEFS.s
   Uses
      None
Comment: VICINTSELECT unused
VICVECTADDR FFFFF030

Symbol: VICVECTADDR
   Definitions
      At line 15 in file REG_DEFS.s
   Uses
      None
Comment: VICVECTADDR unused
48 symbols
392 symbols in table
